<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jay Khodiyar General Store</title>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3514/3514251.png" type="image/png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>
<style>
</style>

<body>

    <div class="container mt-2">
        <div class="row justify-content-center">
            <div class="col-md-12 col-md-6 mt-2">
                <div class="col-md-12 bname">
                    <h2>Jay Khodiyar</h2>
                    <p>General Store</p>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search Here.." id="searchInput">
                    </div>
                </div>
                <div class="list">
                    <div class="mx-auto text-center p-4">
                        <div class="spinner-border" role="status"></div>
                        <div class="sr-only">Loading...</div>
                    </div>


                    <!-- Add more cards as needed -->
                </div>

                <div class="modal fade" id="editCardModal" tabindex="-1" aria-labelledby="editCardModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editCardModalLabel">Editing <span>#<span
                                            id="modalCardId"></span></span></h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div id="modal-body" class="modal-body">
                                <form>
                                    <div class="minput">
                                        <label>Item Image Link</label>
                                        <input id="imglink" type="text" class="form-control"
                                            placeholder="Enter image link here" >
                                    </div>
                                    <div class="minput">
                                        <label>Item Name</label>
                                        <input id="itemname" type="text" class="form-control"
                                            placeholder="Enter item name" >
                                    </div>
                                    <div class="minput">
                                        <label>Item Value of KG</label>
                                        <input id="ippkg" type="number" class="form-control"
                                            placeholder="Enter price of KG" >
                                    </div>
                                    <div class="mt-3">
                                        <div><button type="button" class="btn btn-danger" data-bs-dismiss="modal"
                                                id="deleteItem" aria-label="Delete"><i
                                                    class="bi bi-trash3-fill"></i></button></div>
                                        <div><button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                                id="saveandclose" aria-label="SaveandClose">Save & Close</button></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="floatingdiv">

                    <button title="Adding Item" class="btn btn-floating btn-primary" id="addItem" onclick="aBtn()">
                        <i class="bi bi-plus"></i>
                    </button>

                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and Popper.js (optional) -->

    <!-- Bootstrap JS and Popper.js (optional) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
    <!-- Add these scripts after your Bootstrap and jQuery scripts -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDYF1MoFUCozgh6PfsH-nM1avUTbxSM_rY",
            authDomain: "my-store-11-6b8f5.firebaseapp.com",
            databaseURL: "https://my-store-11-6b8f5-default-rtdb.firebaseio.com",
            projectId: "my-store-11-6b8f5",
            storageBucket: "my-store-11-6b8f5.appspot.com",
            messagingSenderId: "719774944841",
            appId: "1:719774944841:web:9ac216f8ffb2e49bcc7998"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

        const database = getDatabase();




        document.addEventListener("DOMContentLoaded", function () {
            const cardsContainer = document.querySelector('.list');
            const searchInput = document.getElementById('searchInput');
            const modeldiv =document.getElementById("modal-body");

            // Function to create a card element
            function createCard(data, itemId) {
                const card = document.createElement('div');
                card.classList.add('card');
                const model=document.createElement('div');
                

                    card.innerHTML = `
            <div class="row g-0 align-items-center">
                <div class="col-md-8">
                    <div id="clickable" class="card-body">
                        <h6 class="card-id">#<span id="itmid">${itemId}</span></h6>
                        <h5 class="card-title">${data.itmnm}</h5>
                        <p class="card-text"><i class="bi bi-clock"></i> ${formatCustomDateTime(data.edtime)}</p>
                        </div>
                        </div>
                <div class="col-md-4">
                    <img src="${data.itmimg}" class="rounded-start card-img" alt="Card Image">
                </div>
            </div>
            <div class="container card-footer">
                <div class="p-w-box">
                    <div class="price">₹<input class="cusPrice form-control" type="number" placeholder="₹" value="10"></div>
                    <div class="weight" id="weight">${Math.round((1000 / data.ppkg) * 10)}gm</div>
                </div>
                <div class="p-w-box">
                    <div class="price">₹<span id="price2">${data.ppkg / 4}</span></div>
                    <div class="weight" id="weight250">250gm</div>
                </div>
                <div class="p-w-box">
                    <div class="price">₹<span id="price3">${data.ppkg / 2}</span></div>
                    <div class="weight" id="weight500">500gm</div>
                </div>
                <div class="p-w-box">
                    <div class="price">₹<span id="price4">${data.ppkg}</span></div>
                    <div class="weight" id="weight1">1kg</div>
                </div>
            </div>
        `;
        model.innerHTML=`<form>
                                    <div class="minput">
                                        <label>Item Image Link</label>
                                        <input id="imglink" type="text" class="form-control"
                                            placeholder="Enter image link here" >
                                    </div>
                                    <div class="minput">
                                        <label>Item Name</label>
                                        <input id="itemname" type="text" class="form-control"
                                            placeholder="Enter item name" value="">
                                    </div>
                                    <div class="minput">
                                        <label>Item Value of KG</label>
                                        <input id="ippkg" type="number" class="form-control"
                                            placeholder="Enter price of KG" >
                                    </div>
                                    <div class="mt-3">
                                        <div><button type="button" class="btn btn-danger" data-bs-dismiss="modal"
                                                id="deleteItem" aria-label="Delete"><i
                                                    class="bi bi-trash3-fill"></i></button></div>
                                        <div><button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                                id="saveandclose" aria-label="SaveandClose">Save & Close</button></div>
                                    </div>
                                </form>`;

                // Event listener for the .cusPrice input within the dynamically created card
                card.querySelector('.cusPrice').addEventListener('input', function () {
                    var customPrice = parseFloat(this.value);
                    var weightElement = card.querySelector('.weight');

                    // Check if customPrice is a valid number
                    if (!isNaN(customPrice)) {
                        // Calculate and update the weight content within the specific card
                        var weightValue = Math.round((1000 / data.ppkg) * customPrice);
                        weightElement.textContent = weightValue + 'gm';
                    } else {
                        // Handle the case when the entered value is not a valid number
                        console.log('Invalid input for customPrice');
                        // You might want to show an error message to the user
                    }
                });

                return card;
            }

            // Function to fetch data from Firebase
            function fetchDataFromFirebase() {
                const itemsRef = ref(database, 'Items');
               // const itemsRefbyID = ref(database, 'Items/' + itemId);

                onValue(itemsRef, (snapshot) => {
                    const items = snapshot.val();

                    // Clear existing cards
                    cardsContainer.innerHTML = '';

                    // Iterate through each item and create a card
                    Object.keys(items).forEach((itemId) => {
                        const cardData = items[itemId];
                        const card = createCard(cardData, itemId);


                        // Append the card to the container
                        cardsContainer.appendChild(card);
                    });
                });
            }
            function filterCards(searchText) {
                const cards = document.querySelectorAll('.card');

                cards.forEach((card) => {
                    const cardTitle = card.querySelector('.card-title').textContent.toLowerCase();
                    const cardId = card.querySelector('.card-id').textContent.toLowerCase();

                    if (searchText === '' || cardTitle.includes(searchText) || cardId.includes(searchText)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            // Event listener for search input
            searchInput.addEventListener('input', function () {
                const searchText = this.value.trim().toLowerCase();
                filterCards(searchText);
            });


            // const addItemButton = document.getElementById('addItem');
            // addItemButton.addEventListener('click', function () {
            //     addNewItem();
            //     //prompt("clicked button");
            // });

            function formatCustomDateTime(timestamp) {
                const options = { day: 'numeric', month: 'numeric', year: '2-digit', hour: 'numeric', minute: 'numeric', hour12: true };
                const dateObject = new Date(timestamp * 1000); // Convert seconds to milliseconds
                const formattedDateTime = dateObject.toLocaleString('en-GB', options);

                return formattedDateTime;
            }
            //const addNew = document.getElementById("addItem");

            // Call the function to fetch data
            fetchDataFromFirebase();
        });
        function aBtn() {
            const itemsRef = ref(database, 'Items');

            // Get the last item from Firebase
            get(child(itemsRef, '2')) // Replace '2' with the actual last item ID
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        const lastItemData = snapshot.val();

                        // Create a new item by duplicating the last item
                        const newItemId = Object.keys(lastItemData)[0] + 1; // Assuming the keys are numeric

                        // Set the new item in Firebase
                        set(ref(itemsRef, newItemId), lastItemData)
                            .then(() => {
                                // Fetch and display updated data
                                fetchDataFromFirebase();
                            })
                            .catch((error) => {
                                console.error("Error adding new item: ", error);
                            });
                    }
                })
                .catch((error) => {
                    console.error("Error fetching last item: ", error);
                });
        }




    </script>
    <script src="main.js"></script>


</body>

</html>